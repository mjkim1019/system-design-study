# 2장. 개략적인 규모 추정

시스템 용량이나 성능 요구사항에 대한 개략적으로 추정은 왜 필요할까?

설계를 한 후, 실제 개발에 들어가기 전에 설계가 요구사항에 부합하는지 확인이 필요하기 때문이다.

개략적인 규모 추정을 효과적으로 하기 위해서는 2의 제곱수, 응답지연(latency) 값, 그리고 가용성에 관계된 수치, 이렇게 규모 확장성을 표현하는 기본기를 잘 알고 있어야 한다. 

## 2의 제곱수

분산 시스템에서는 데이터의 볼륨을 2의 제곱수로 다룬다.

데이터의 최소 단위는 1 byte == 8(2^3) bit 이다. 참고로 ASCII 문자 하나가 1바이트이다.

아래 표는 흔히 사용하는 데이터 단위이므로 기억해놓으면 좋다.
![image](https://github.com/user-attachments/assets/b432fd1f-b059-4644-a89b-1f7268ead189)

## 응답지연(latency) 값

구글의 제프 딘이 공개한 컴퓨터에서 구현한 연산들의 응답지연 값이다.
![image](https://github.com/user-attachments/assets/d0580a09-dd10-430f-9463-1e4aa21061b1)

위 수치들을 분석하면 다음과 같은 결론이 나온다.

- 캐시는 정말 빠르다
- 메모리는 빠르지만, 디스크는 느리다
- 단순 압축 알고리즘은 빠르다
- 데이터 전송은 데이터의 크기에 영향을 받기 때문에, 가능한 압축해서 전송하자
- 여러 지역으로 분산되어 있는 데이터 센터는, 센터 간 데이터를 주고 받는 데 시간이 걸린다

## 가용성에 관계된 수치

고가용성이란, 오랜시간 지속적으로 중단 없이 운영될 수 있는 능력을 말한다.

대부분의 서비스는 99-100% 사이의 값을 갖고, 100%는 서비스가 한 번도 중단된 적 없음을 의미한다.

SLA(Service Level Agreement)는 서비스 사업자와 고객 사이에 맺어진 합의를 말하며, 이 합의에는 가용성(uptime)이 공식적으로 기술되어 있다. 

가용시간은 공식적으로 9를 많이 사용하고, 9가 많을수록 좋다고 볼 수 있다.
![image](https://github.com/user-attachments/assets/d1527367-1cc4-4d40-a6d5-190f11458996)

## 예제: 트위터 QPS와 저장소 요구량 추정

**가정**

- 월간 사용자(MAU)는 3억명이다
- 50%의 사용자가 매일 트위터를 사용한다
- 평균적으로 각 사용자는 매일 2건의 트윗을 올린다
- 미디어를 포함하는 트윗은 10%다
- 미디어 트윗의 평균 크기는 1MB이다
- 데이터는 5년간 보관된다

**추정**

- QPS(Query Per Second) 추정치는?
    
    QPS란 초당 처리되는 쿼리 수로, 주로 데이터베이스나 검색엔진의 성능을 측정할 때 사용된다. 다시 말해, 시스템이 얼마나 많은 조회 요청을 처리할 수 있는지를 나타낸다.
    
    - 일간 사용자(DAU) = 월간 사용자 * 일간 사용 비율
                                 = 3억 * 0.5
                                 = 1.5억
    - QPS = DAU * 평균 글 작성 수(Query 발생 수) / 24시간 / 3600초
             = 1.5억 * 2트윗 / 24시간 / 3600초 
             = 약 3500
    - 최대 QPS = 2 * 3500 = 7000
- 미디어 저장을 위한 저장소 요구량은?
    - 미디어 저장소 요구량 = DAU * 평균 글 작성 수 * 미디어 트윗 비율 * 트윗 평균 크기
                                     = 1.5억 * 2 * 0.1 * 1MB
                                     = 3억 * 1MB = 3억 / 1000 * 1GB = 3억 / 1000000 * 1TB
                                     = 약 30 TB/일
    - 5년간 미디어를 보관하기 위한 저장소 요구량 = 5 * 365 * 30 TB/일 = 약 55PB
