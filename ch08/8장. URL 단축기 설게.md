
# URL 단축기 설계

## **✅ 고전적인 시스템 설계 문제인 tiny url 같은 URL 단축기를 설계하기**

### 1. 설계 범위 
- URL 단축 : 주어진 긴 URL을 훨씬 짧게 줄인다.
- URL 리디렉션 : 축약된 URL로 HTTP 요청이 오면 원래 URL로 안내한다.
- 높은 가용성과 규모 확장성, 장애 감내가 요구된다.
  
**개략적 추정**
- 쓰기 연산 : 매일 1억개의 단축 URL을 생성
- 초당 쓰기 연산 : 1억 / 24 / 3600 = 1,160개
- 읽기 연산 : 읽기와 쓰기의 비율은 10 : 1 이라고 대략 가정하자. 그럼 대략 11,160 개
- URL 단축 서비스를 10년간 운영해야한다면, 1억 x 365 x 10 = 3,650억개의 레코드를 보관
- 축약 전 URL의 평균 길이를 100이라 가정
- 10년 동안 필요한 용량은 365,000 억바이트 = 36.5TB 이다.

### 2. 개략적 설계안

> 1.API 엔드포인트&nbsp;&nbsp;2.URL 리디렉션&nbsp;&nbsp;3.URL 단축

  #### 1.API 엔드포인트
  - 클라이언트는 서버가 제공하는 API 엔드포인트로 서버와 통신한다.
  - 엔드포인트를 REST 스타일로 설계한다.
    - 1.URL 단축용 엔드포인트 : 단축 URL을 생성하고자 하는 클라이언트는 엔드포인트에 기존 긴 URL을 일자로 실어 POST 요청 보내야한다.
      ```
      POST /api/v1/data/shorten
      인자 : { longUrl : longUrlString }
      반환 : 단축된 URL
      ```
    - 2.URL 리디렉션용 엔드포인트 : 단축 URL에 대해 HTTP 요청이 오면 원래 URL로 보내주기 위한 용도의 엔드 포인트. GET 요청 보내야한다.
      ```
      GET /api/v1/shortUrl
      반환 : HTTP 리디렉션 목적지가 될 원래 URL
      ```
  #### 2. URL 리디렉션
  - 브라우저에 단축 URL 입력했을때 생기는 일
    
![image](https://github.com/user-attachments/assets/82e6f581-b2ef-4e3d-9bbd-924c7b103935)
  - 단축 URL을 받은 서버는 그 URL을 원래 URL로 바꿔서 301 응답의 Location 헤더에 넣어 반환한다.
![image](https://github.com/user-attachments/assets/fd874446-044f-425a-8dcc-9b589ecf49b0)
  - 301 Permanently Moved :
    - 이 응답은 해당 URL에 대한 HTTP 요청의 처리 책임이 영구적으로 Location 헤더에 반환된 URL(원래 URL)로 이전되었다는 응답이다.
    - 영구적으로 이전되었기 때문에, 브라우저에서 캐시한다. ➡ 추후 같은 단축 URL에 요청 보낼 때 브라우저는 캐시된 원래 URL로 요청
  - 302 Found:
    - 이 응답은 일시적으로 Location 헤더에 반환된 URL로 이전되었다는 응답이다.
    - 클라이언트의 요청은 언제나 단축 URL 서버에 먼저 보내진 후에 원래 URL로 리디렉션된다.
  - 서버 부하를 줄이는 것이 중요하다면 **301 Permanently moved**를 사용하는 것이 좋다. 하지만 트래픽 분석이 필요할 때는, **302 Found**를 써 클릭 발생률이나 발생 위치를 추적하는 데 좀 더 유리하다.
  - URL 리디렉션을 구현하는 가장 직관적인 방법은 해시테이블을 이용해, **< 단축 URL, 원래 URL >** 의 쌍을 저장하는 방법이다.
    - 원래 URL : hashTable.get(단축 URL)
    - 301 또는 302 응답 Location 헤더에 원래 URL을 넣어 전송
   
  #### 3. URL 단축
  - 단축 URL을 www.tinyurl.com/{hashValue} 라고 한다면, 중요한 것은 긴 URL을 이 해시 값으로 대응시키는 해시 function을 찾는 것이다.
![image](https://github.com/user-attachments/assets/0e05adf3-1a78-41c3-b6de-7a52e8ecaf6d)

  - 해시함수는 다음 요구 사항을 만족해야한다.
    - 긴 URL이 다른 값이면, 해시값도 달라야한다.
    - 계산된 해시값은 원래 값으로 원복될 수 있어야한다.
      
### 3. 상세 설계

> 1.데이터 모델&nbsp;&nbsp;2.해시 함수&nbsp;&nbsp;3.URL 단축 및 리디렉션

  #### 1.데이터 모델
  - 
  #### 2. 해시 함수
  #### 3. URL 단축기 상세 설계
  #### 4. URL 리디렉션 상세 설계


  https://velog.io/@kshired/%EA%B0%80%EC%83%81-%EB%A9%B4%EC%A0%91-%EC%82%AC%EB%A1%80%EB%A1%9C-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%8C%80%EA%B7%9C%EB%AA%A8-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EC%84%A4%EA%B3%84-%EA%B8%B0%EC%B4%88-%EB%B6%84%EC%82%B0-%EC%8B%9C%EC%8A%A4%ED%85%9C%EC%9D%84-%EC%9C%84%ED%95%9C-%EC%9C%A0%EC%9D%BC-ID-%EC%83%9D%EC%84%B1%EA%B8%B0-%EC%84%A4%EA%B3%84-f4h58yph
